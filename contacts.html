<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‰¯ç‹åº„ä¹¡æœºå…³å¹²éƒ¨é€šè®¯å½•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f0f2f5;
            color: #333;
        }
        
        /* ç™»å½•ç•Œé¢æ ·å¼ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 100%;
            max-width: 400px;
            margin: 20px;
        }
        
        .login-title {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        
        .password-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
        }
        
        .error-msg {
            color: #d32f2f;
            margin-top: 15px;
            font-size: 0.9em;
            display: none;
        }
        
        /* ä¸»è¦å†…å®¹æ ·å¼ */
        .main-content {
            display: none;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .header-buttons {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header-btn {
            padding: 10px 20px;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .add-contact-btn {
            background: rgba(76, 175, 80, 0.9);
        }
        
        .add-contact-btn:hover {
            background: rgba(76, 175, 80, 1);
        }
        
        .data-manage-btn {
            background: rgba(255, 193, 7, 0.9);
        }
        
        .data-manage-btn:hover {
            background: rgba(255, 193, 7, 1);
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .emergency-section {
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .emergency-section h3 {
            color: #d32f2f;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .emergency-contacts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .emergency-card {
            background: #ffebee;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #d32f2f;
        }
        
        .emergency-card .title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .emergency-card .phone {
            color: #d32f2f;
            font-size: 1.2em;
        }
        
        .search-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .search-controls {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        input[type="text"], select {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-item .label {
            color: #666;
        }
        
        .stat-item .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .contacts-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .contact-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }
        
        .contact-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }
        
        .contact-card .name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .contact-card .department {
            color: #667eea;
            font-size: 0.95em;
            margin-bottom: 12px;
        }
        
        .contact-card .info-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            color: #555;
            font-size: 0.95em;
        }
        
        .contact-card .info-item .icon {
            margin-right: 8px;
            width: 16px;
        }
        
        /* æ“ä½œæŒ‰é’®æ ·å¼ */
        .contact-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .btn-edit, .btn-delete {
            padding: 5px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .btn-edit {
            background: #4CAF50;
            color: white;
        }
        
        .btn-edit:hover {
            background: #45a049;
        }
        
        .btn-delete {
            background: #f44336;
            color: white;
        }
        
        .btn-delete:hover {
            background: #da190b;
        }
        
        .no-results {
            text-align: center;
            padding: 60px;
            color: #999;
            font-size: 1.1em;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 1.5em;
            color: #333;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .btn-primary, .btn-secondary {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e9e9e9;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        /* æˆåŠŸæ¶ˆæ¯æ ·å¼ */
        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        /* æ–‡ä»¶è¾“å…¥æ¡†æ ·å¼ */
        #jsonFileInput {
            transition: all 0.3s;
            cursor: pointer;
        }
        
        #jsonFileInput:hover {
            border-color: #667eea !important;
            background-color: #f8f9ff;
        }
        
        /* é¢„è§ˆåˆ—è¡¨æ ·å¼ */
        #importPreviewList {
            font-family: inherit;
        }
        
        #importPreviewList::-webkit-scrollbar {
            width: 8px;
        }
        
        #importPreviewList::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        #importPreviewList::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        #importPreviewList::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* å•é€‰æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.1);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .header-buttons {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }
            
            .header-btn {
                flex: 1;
                min-width: 120px;
            }
            
            .search-controls {
                grid-template-columns: 1fr;
            }
            
            .contact-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
                max-width: 700px;
                max-height: 80vh;
                overflow-y: auto;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <h2 class="login-title">ğŸ” ç³»ç»ŸéªŒè¯</h2>
            <p class="login-subtitle">è‰¯ç‹åº„ä¹¡æœºå…³å¹²éƒ¨é€šè®¯å½•<br>è¯·è¾“å…¥è®¿é—®å¯†ç </p>
            <input type="password" id="passwordInput" class="password-input" placeholder="è¯·è¾“å…¥å¯†ç " maxlength="10">
            <button onclick="checkPassword()" class="login-btn">éªŒè¯ç™»å½•</button>
            <div id="errorMsg" class="error-msg">âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div id="mainContent" class="main-content">
        <div class="container">
            <div class="header">
                <div class="header-buttons">
                    <div>
                        <button onclick="showAddModal()" class="header-btn add-contact-btn">+ æ–°å¢è”ç³»äºº</button>
                        <button onclick="showDataManagement()" class="header-btn data-manage-btn">ğŸ“Š æ•°æ®ç®¡ç†</button>
                    </div>
                    <button onclick="logout()" class="header-btn logout-btn">é€€å‡ºç™»å½•</button>
                </div>
                <h1>è‰¯ç‹åº„ä¹¡æœºå…³å¹²éƒ¨é€šè®¯å½•</h1>
                <p>å†…éƒ¨ä½¿ç”¨ Â· è¯·å¦¥å–„ä¿ç®¡</p>
            </div>
            
            <div id="successMessage" class="success-message"></div>
            
            <div class="emergency-section">
                <h3>ğŸš¨ ç´§æ€¥è”ç³»ç”µè¯</h3>
                <div class="emergency-contacts">
                    <div class="emergency-card">
                        <div class="title">åŒºæ”¿åºœåŠ</div>
                        <div class="phone">ğŸ“ 63032789</div>
                    </div>
                    <div class="emergency-card">
                        <div class="title">åŒºå§”åŠå…¬å®¤</div>
                        <div class="phone">ğŸ“ 63032888</div>
                    </div>
                    <div class="emergency-card">
                        <div class="title">åŒºåº”æ€¥åŠ</div>
                        <div class="phone">ğŸ“ 68692821</div>
                    </div>
                </div>
            </div>
            
            <div class="search-section">
                <div class="search-controls">
                    <input type="text" id="searchInput" placeholder="æœç´¢å§“åã€éƒ¨é—¨æˆ–ç”µè¯å·ç ..." onkeyup="filterContacts()">
                    <select id="departmentFilter" onchange="filterContacts()">
                        <option value="">æ‰€æœ‰éƒ¨é—¨</option>
                    </select>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <span class="label">æ€»äººæ•°ï¼š</span>
                        <span class="value" id="totalCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">ç­›é€‰ç»“æœï¼š</span>
                        <span class="value" id="filteredCount">0</span>
                    </div>
                </div>
            </div>
            
            <div class="contacts-section">
                <div class="contact-grid" id="contactGrid">
                    <!-- è”ç³»äººå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢/ç¼–è¾‘è”ç³»äººæ¨¡æ€æ¡† -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">æ–°å¢è”ç³»äºº</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="contactForm">
                <div class="form-group">
                    <label for="contactName">å§“å *</label>
                    <input type="text" id="contactName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="contactDepartment">éƒ¨é—¨ *</label>
                    <select id="contactDepartment" name="department" required>
                        <option value="">è¯·é€‰æ‹©éƒ¨é—¨</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contactMobile">æ‰‹æœºå·ç </label>
                    <input type="tel" id="contactMobile" name="mobile" pattern="[0-9]{11}">
                </div>
                <div class="form-group">
                    <label for="contactOfficePhone">åŠå…¬ç”µè¯</label>
                    <input type="tel" id="contactOfficePhone" name="officePhone">
                </div>
                <div class="form-group">
                    <label for="contactHomePhone">å®¶åº­ç”µè¯</label>
                    <input type="tel" id="contactHomePhone" name="homePhone">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn-primary" id="submitBtn">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ•°æ®ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="dataManagementModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">æ•°æ®ç®¡ç†</h3>
                <button class="close-btn" onclick="closeDataManagement()">&times;</button>
            </div>
            <div style="margin: 20px 0;">
                <div class="form-group">
                    <label>å½“å‰çŠ¶æ€</label>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <div>ğŸ“Š æ€»è”ç³»äººæ•°ï¼š<strong id="dataManageCount">0</strong></div>
                            <div>ğŸ’¾ æ•°æ®å·²è‡ªåŠ¨ä¿å­˜</div>
                            <div>â° æœ€åæ›´æ–°ï¼š<span id="lastUpdateTime">æœªçŸ¥</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>æ•°æ®å¯¼å‡º</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                        <button type="button" class="btn-secondary" onclick="exportDataAsJson()" style="background: #28a745; color: white;">
                            ğŸ“¥ å¯¼å‡ºJSONæ–‡ä»¶
                        </button>
                        <button type="button" class="btn-secondary" onclick="exportDataForBackup()" style="background: #6f42c1; color: white;">
                            ğŸ’¾ å¯¼å‡ºå¤‡ä»½æ–‡ä»¶
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>æ•°æ®å¯¼å…¥</label>
                    <div style="margin-bottom: 15px;">
                        <input type="file" id="jsonFileInput" accept=".json" style="margin-bottom: 10px; width: 100%; padding: 10px; border: 2px dashed #ddd; border-radius: 8px; cursor: pointer;">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn-secondary" onclick="importJsonData()" style="background: #17a2b8; color: white;">
                                ğŸ“¤ å¯¼å…¥JSONæ–‡ä»¶
                            </button>
                            <button type="button" class="btn-secondary" onclick="clearFileInput()" style="background: #6c757d; color: white;">
                                ğŸ—‘ï¸ æ¸…é™¤é€‰æ‹©
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>å±é™©æ“ä½œ</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                        <button type="button" class="btn-secondary btn-danger" onclick="clearLocalStorage()">
                            ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°æ•°æ®
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>è¯´æ˜</label>
                    <div style="font-size: 0.9em; color: #666; line-height: 1.6; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>å¯¼å‡ºåŠŸèƒ½ï¼š</strong><br>
                        â€¢ <strong>JSONæ–‡ä»¶</strong>ï¼šæ ‡å‡†æ ¼å¼ï¼Œå¯ç”¨äºæ•°æ®äº¤æ¢<br>
                        â€¢ <strong>å¤‡ä»½æ–‡ä»¶</strong>ï¼šåŒ…å«å®Œæ•´å…ƒæ•°æ®çš„å¤‡ä»½<br><br>
                        <strong>å¯¼å…¥åŠŸèƒ½ï¼š</strong><br>
                        â€¢ æ”¯æŒæ ‡å‡†JSONæ ¼å¼çš„è”ç³»äººæ–‡ä»¶<br>
                        â€¢ è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†é‡å¤è”ç³»äºº<br>
                        â€¢ å¯¼å…¥å‰ä¼šæ˜¾ç¤ºé¢„è§ˆå’Œç¡®è®¤<br>
                        â€¢ æ”¯æŒæ‰¹é‡å¯¼å…¥å¤§é‡è”ç³»äººæ•°æ®
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-primary" onclick="closeDataManagement()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="importPreviewModal" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title">å¯¼å…¥é¢„è§ˆ</h3>
                <button class="close-btn" onclick="closeImportPreview()">&times;</button>
            </div>
            <div style="margin: 20px 0;">
                <div id="importSummary" style="padding: 15px; background: #e7f3ff; border-radius: 8px; margin-bottom: 20px;"></div>
                
                <div class="form-group">
                    <label>é¢„è§ˆæ•°æ® (æ˜¾ç¤ºå‰10æ¡)</label>
                    <div id="importPreviewList" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                        <!-- é¢„è§ˆæ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>

                <div id="conflictSection" style="display: none;">
                    <div class="form-group">
                        <label style="color: #d32f2f;">âš ï¸ å‘ç°é‡å¤è”ç³»äºº</label>
                        <div style="margin-bottom: 15px;">
                            <label style="font-weight: normal;">
                                <input type="radio" name="conflictResolution" value="skip" checked>
                                è·³è¿‡é‡å¤çš„è”ç³»äººï¼ˆæ¨èï¼‰
                            </label><br>
                            <label style="font-weight: normal;">
                                <input type="radio" name="conflictResolution" value="overwrite">
                                è¦†ç›–ç°æœ‰è”ç³»äºº
                            </label><br>
                            <label style="font-weight: normal;">
                                <input type="radio" name="conflictResolution" value="duplicate">
                                ä¿ç•™é‡å¤è”ç³»äººï¼ˆä¼šäº§ç”Ÿé‡å¤æ•°æ®ï¼‰
                            </label>
                        </div>
                        <div id="conflictList" style="max-height: 150px; overflow-y: auto; background: #fff3cd; padding: 10px; border-radius: 8px;">
                            <!-- å†²çªåˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeImportPreview()">å–æ¶ˆ</button>
                <button type="button" class="btn-primary" onclick="confirmImport()">ç¡®è®¤å¯¼å…¥</button>
            </div>
        </div>
    </div>
    
    <script>
        // å¯†ç éªŒè¯åŠŸèƒ½
        const correctPassword = '159357';
        
        // æœ¬åœ°å­˜å‚¨é”®å
        const STORAGE_KEY = 'lwz_contacts_data';
        const VERSION_KEY = 'lwz_data_version';
        const CURRENT_VERSION = '1.0';
        
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            
            if (password === correctPassword) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('errorMsg').style.display = 'none';
                initializeContacts();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        function logout() {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('passwordInput').value = '';
            document.getElementById('errorMsg').style.display = 'none';
        }
        
        // å›è½¦é”®ç™»å½•
        document.getElementById('passwordInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        });
        
        // é»˜è®¤çš„é€šè®¯å½•æ•°æ®
        const defaultContactsData = `1,å…šæ”¿,é‡‘æ™¶,,,13820868619
2,å…šæ”¿,å°šç”¨é©,,,13312070700
3,å…šæ”¿,åˆ˜æ­£æ–‡,,,15620565556
4,å…šæ”¿,æ—é›·,,,18102116868
5,å…šæ”¿,é©¬å›é™,,,13820025188
6,å…šæ”¿,èµµå…ƒå¤,,,13602041495
7,å…šæ”¿,å¼ é›¯æ™¶,,,15822730000
8,å…šæ”¿,å¾ç¦é¹,,,18622036918
9,å…šæ”¿,é©¬ç‡•ä¸½,,,13672035881
10,å…šæ”¿,é­æ™ºè¶…,,,13512477666
11,å…šæ”¿,åˆ˜è‰³,,,15620875826
12,å…šæ”¿,å§šè‰¯ç”°,,,15510997472
13,å…šæ”¿,å¼ å®å¾·,,,13752177538
14,å…šæ”¿,åˆ˜å­é‘«,,,18522720493
15,å…šæ”¿,å¼ å»ºäº­,,,15510913720
16,å…šæ”¿,ä¾¯ç‰åµ©,,,15854333267
17,å…šå§”åŠ(äººå¤§åŠ),å­Ÿé“­è¾‰,68120063,,18622699053
18,å…šå§”åŠ(äººå¤§åŠ),æ¨Šè“‰,68120063,,17627684548
19,å…šå§”åŠ(äººå¤§åŠ),éƒ‘å‡¯,68120063,,17866829580
20,å…šå§”åŠ(äººå¤§åŠ),ç‹ä¹”,68120063,,15602189093
21,å…šå§”åŠ(äººå¤§åŠ),ç‹å¿ƒæ€¡,68120063,,13114951612
22,å…šå§”åŠ(äººå¤§åŠ),è£è“‰,68120063,,17622571603
23,å…šå§”åŠ(äººå¤§åŠ),æ²™ç³ç³,68120063,,19922636889
24,å…šå§”åŠ(äººå¤§åŠ),åˆ˜æ™”,68120063,,15922000527
25,å…šå§”åŠ(äººå¤§åŠ),ç‹å…‹,,,13920473979
26,æ”¿åºœåŠ,å§šé ”,68120168,,15620371493
27,æ”¿åºœåŠ,é‚“æ³¢,68120168,,18920971591
28,æ”¿åºœåŠ,é™ˆå®‡æ¸…,68120168,,17726071230
29,æ”¿åºœåŠ,é»å¿—ä¼š,68120168,,13821821523
30,çºªæ£€å®¤,ç‹å½¬,68123106,,13662162166
31,çºªæ£€å®¤,å­”ä»¤æŒ¯,68123106,,15522648761
32,å·¥ä¼šå¦‡è”,éƒæµ·åªš,68123109,,18810565483
33,å·¥ä¼šå¦‡è”,è´¾ç¡•,68123109,,15822312299
34,å†œä¸šåŠ,éƒ­å¤§æ˜Ÿ,68120068,,15522190533
35,å†œä¸šåŠ,äºä¿Šç”Ÿ,68120068,,13132273512
36,å†œä¸šåŠ,é»„æ€èŒ,68120068,,13212056669
37,å†œä¸šåŠ,æ¨æŒ¯å¼º,68120068,,15922075300
38,å†œä¸šåŠ,å•†ç¦ä¸½,68120068,,18502266961
39,å†œä¸šåŠ,åˆ˜å¸…,68120068,,18698065373
40,å†œä¸šåŠ,å­™ç­–,68120068,,18920769595
41,å†œä¸šåŠ,ææ©æ¥,68120068,,13820820799
42,å†œä¸šåŠ,æ—å¹¿è‰³,68120068,,15302029861
43,å†œä¸šåŠ,å­™æ˜Œå¹³,68120068,,18222909243
44,å†œä¸šåŠ,å¼ å¼º,68120068,,13502088856
45,å·¥ä¸šåŠ,æœé›¨é¾™,68120071,,13820888863
46,å·¥ä¸šåŠ,éƒ­ä¿Šç²,68120071,,13820058698
47,å·¥ä¸šåŠ,äºæ´ªæ˜¥,68120071,,13702079811
48,å·¥ä¸šåŠ,æœæ•ˆå†›,68120071,,13920016465
49,å·¥ä¸šåŠ,äºé¡ºå°§,68120071,,15022744833
50,å·¥ä¸šåŠ,æ›¹å½¤å½¤,68120071,,13512820088
51,å·¥ä¸šåŠ,æœæ©ç¦¹,68120071,,17526536004
52,å¸æ³•æ‰€,é«˜æ°¸ä¹‰,68120079,,15902288868
53,å¸æ³•æ‰€,èµµå¨Ÿ,68120079,,13672028571
54,å¸æ³•æ‰€,åˆ˜ç³,68120079,,18522506497
55,å®‰ç›‘,èµµç£Š,68123108,,18622852119
56,å®‰ç›‘,å¼ é¹¤é¦¨,68123108,,18602630455
57,å®‰ç›‘,åˆ˜é˜³,68123108,,18302275555
58,å®‰ç›‘,å¼ æ¶›,68123108,,15510883180
59,å®‰ç›‘,æ»‘æ¡‚æ˜¥,68123108,,18920591566
60,å®‰ç›‘,æ¨å¥,68123108,,13022280995
61,å«å¥åŠ,éƒæ ‘äº‘,68120369,,15002263296
62,å«å¥åŠ,å®‰ç§€è‹±,68120369,,13132043877
63,å«å¥åŠ,æ—æ°¸äº®,68120084,,13821169309
64,å«å¥åŠ,ç”°é™,68120084,,13323393635
65,å«å¥åŠ,å‘¨ä½œç‡•,68120084,,13516260311
66,å«å¥åŠ,éƒç»´,68120084,,13672157681
67,æ­¦è£…éƒ¨,æ¨æ•¬ç£Š,,,15822211208
68,ç»¼æ²»åŠä¿¡è®¿åŠ,ç¿Ÿç‚³æµ©,68128992,,18822620909
69,ç»¼æ²»åŠä¿¡è®¿åŠ,è‘›å­¦å‡¯,68128992,,13302109995
70,ç»¼æ²»åŠä¿¡è®¿åŠ,å½­å›½æ”¿,68128992,ç—…å‡,13682003180
71,ç»¼æ²»åŠä¿¡è®¿åŠ,æœ±æ…§æ•,68128992,,13526102969
72,ç»¼æ²»åŠä¿¡è®¿åŠ,å¢å»ºæ—»,68128992,,15222788369
73,ç»¼æ²»åŠä¿¡è®¿åŠ,å®‹å‹ç¥¥,68128992,,13132115305
74,ä¹¡æ–‡æ•™,å¼ è‹±æˆ,68120044,,13207688889
75,ä¹¡æ–‡æ•™,äºæ…§æ•,68120044,,13920560996
76,ç»Ÿè®¡åŠ,éƒ­å·çª,68123096,,15122407868
77,ç»Ÿè®¡åŠ,ç‹é’°,68123096,,15122055520
78,ç»Ÿè®¡åŠ,æœè¿éœ,68123096,,13642169402
79,ç»Ÿè®¡åŠ,æœé”,68123096,,18526034253
80,åŸå»ºåŠ,åˆ˜ç”Ÿä¼š,68123156,,13207653623
81,åŸå»ºåŠ,ç‹è•Š,68123156,,15733298634
82,åŸå»ºåŠ,æ¨å¸…,68123156,,15222225272
83,åŸå»ºåŠ,æ½˜ç¦ç¦,68123156,,18722062480
84,ç¯å«åŠï¼ˆæˆ·å•åŠï¼‰,é²å¿—å¼º,68121399,,13752738032
85,ç¯å«åŠï¼ˆæˆ·å•åŠï¼‰,å¼ å¿ å»º,68121399,,13662052266
86,ç¯å«åŠï¼ˆæˆ·å•åŠï¼‰,éŸ©ç´ å‹‡,68121399,,13502192191
87,ç¯å«åŠï¼ˆæˆ·å•åŠï¼‰,ææ´¥æ´¥,68121399,,13002249856
88,åŠ³åŠ¨ä¿éšœ,åˆ˜åˆš,68120333,,15620975178
89,åŠ³åŠ¨ä¿éšœ,é™ˆå½¦å›,68120333,,15022393432
90,åŠ³åŠ¨ä¿éšœ,èµµèƒœ,68120333,,18502255881
91,åŠ³åŠ¨ä¿éšœ,äº•è,68120333,,18512240576
92,é€€å½¹å†›äººæœåŠ¡ç«™,ç‹ç…œé¢–,68132212,,15122944081
93,é€€å½¹å†›äººæœåŠ¡ç«™,åˆ˜æ¡,68132212,,16600208000
94,æœåŠ¡å¤§å…,å¼ å¿—å‘,68122915,,18920271365
95,è´¢æ”¿æ‰€,æœ±å»ºæ–°,68120081,,13512226667
96,è´¢æ”¿æ‰€,ç‹é›ªå¦,68120081,,15022336693
97,è´¢æ”¿æ‰€,æ½˜ç»è£,68120081,,13102295093
98,è´¢æ”¿æ‰€,è€³è´µç‘,68120081,,15922207913
99,æ°‘æ”¿åŠ,èƒ¡è‰³å,68120078,,18602629788
100,æ°‘æ”¿åŠ,èµµä¸¹,68120078,,13920339342
101,æ°‘æ”¿åŠ,ææ¬£,68120078,,15822322738
102,æ°‘æ”¿åŠ,äºçŠ,68120078,,15522312135
103,æ°‘æ”¿åŠ,å¼ é—°æ™º,68120078,,17301616592
104,æ‘å¸ä¹¡ç®¡,æå¾·ç²,68120456,,13920361122
105,æ‘å¸ä¹¡ç®¡,ææ¶¦æ˜¥,68120456,,18602631890
106,æ‘å¸ä¹¡ç®¡,ææ´ªè‰³,68120456,,15620929970
107,æ²³é•¿åŠ,å¼ æ©å…´,,,18630896160
108,æ‰§æ³•å¤§é˜Ÿ,æœ±å†›ç¦¾,68123098,,15822990028
109,æ‰§æ³•å¤§é˜Ÿ,å®‹é‡‘èƒœ,68123098,,15822990033
110,æ‰§æ³•å¤§é˜Ÿ,é¡¹æ˜†,68123098,,18630808606
111,æ‰§æ³•å¤§é˜Ÿ,æ¢å»ºå¿ ,68123098,,15122547160
112,æ‰§æ³•å¤§é˜Ÿ,åˆ˜é›·,68123098,,18602680361
113,æ‰§æ³•å¤§é˜Ÿ,æ¨æ©ç¥¥,68123098,,13820504831
114,æ‰§æ³•å¤§é˜Ÿ,æ¨é¹,68123098,,15900232223
115,æ‰§æ³•å¤§é˜Ÿ,é«˜æ˜ä¼š,68123098,,15222025492
116,å¸æœº,å¼ æ°¸è·¯,,,13388019299
117,å¸æœº,æ¢é‡‘å›½,,,13821649187
118,é—¨å«1,å¼ æ–‡æ­¦,68122916,,13920907833
119,é—¨å«1,é—«ç¦æ±Ÿ,68122916,,15922075303
120,é—¨å«2,æ¨æ©ç¥¥,68122698,,13820504831
121,é—¨å«2,éƒè¿å¿ ,68122698,68120989,13516108611
122,æ´¾å‡ºæ‰€,å¼ é›¯æ™¶,68120110,,15822730000
123,ç¨åŠ¡æ‰€,é™ˆç›¸,68815027,,13110063666
124,æ°´ç«™,åˆ˜ä¼Ÿ,,,13110015200
125,å¸‚åœºç›‘ç®¡æ‰€,è‘£é‡‘é”‹,68123791,,13752568158
126,é‚®å±€,å…°é¢–,68120405,,15692272230
127,å«ç”Ÿé™¢,ç‹å®è‰¯,68120042,,13212069756
128,å†œå•†è¡Œ,é—«éš½,,,15802299095
129,ç”µä¸šæ‰€,å¼ æ¾œ,68602096,,18920300189
130,ç”µè¯ç«™,å¼ è¾¾,68120999,68120159,18602205375
131,ç”µç®¡ç«™,é©¬è·ƒæ´²,,,13820048444`;

        let contacts = [];
        let departments = new Set();
        let editingContactId = null;
        let nextId = 132; // ä¸‹ä¸€ä¸ªå¯ç”¨ID
        
        // å…¨å±€å˜é‡å­˜å‚¨å¾…å¯¼å…¥çš„æ•°æ®
        let pendingImportData = null;
        let importConflicts = [];

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveContactsToStorage() {
            try {
                const dataToSave = {
                    version: CURRENT_VERSION,
                    contacts: contacts,
                    nextId: nextId,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                console.log('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                alert('ä¿å­˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨ç©ºé—´');
            }
        }

        // ä»æœ¬åœ°å­˜å‚¨è¯»å–æ•°æ®
        function loadContactsFromStorage() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    // æ£€æŸ¥æ•°æ®ç‰ˆæœ¬å…¼å®¹æ€§
                    if (parsedData.version === CURRENT_VERSION && parsedData.contacts) {
                        contacts = parsedData.contacts;
                        nextId = parsedData.nextId || getMaxId() + 1;
                        console.log(`å·²ä»æœ¬åœ°å­˜å‚¨åŠ è½½ ${contacts.length} æ¡è”ç³»äººæ•°æ®`);
                        return true;
                    } else {
                        console.log('æœ¬åœ°å­˜å‚¨æ•°æ®ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                    }
                }
            } catch (error) {
                console.error('è¯»å–æœ¬åœ°æ•°æ®å¤±è´¥:', error);
            }
            
            // å¦‚æœæ²¡æœ‰æœ¬åœ°æ•°æ®æˆ–è¯»å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®
            parseContactsData();
            return false;
        }

        // è·å–å½“å‰æœ€å¤§ID
        function getMaxId() {
            return contacts.length > 0 ? Math.max(...contacts.map(c => c.id)) : 0;
        }

        // æ¸…é™¤æœ¬åœ°å­˜å‚¨æ•°æ®
        function clearLocalStorage() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨çš„æ•°æ®å—ï¼Ÿè¿™å°†æ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½å°†ä¸¢å¤±ï¼')) {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(VERSION_KEY);
                
                // é‡æ–°åŠ è½½é»˜è®¤æ•°æ®
                parseContactsData();
                initializeDepartmentSelects();
                updateStats();
                displayContacts(contacts);
                
                showSuccessMessage('æœ¬åœ°æ•°æ®å·²æ¸…é™¤ï¼Œå·²æ¢å¤åˆ°åˆå§‹çŠ¶æ€');
            }
        }

        // å¯¼å‡ºJSONæ•°æ®ï¼ˆæ ‡å‡†æ ¼å¼ï¼‰
        function exportDataAsJson() {
            const exportData = {
                exportInfo: {
                    title: "è‰¯ç‹åº„ä¹¡æœºå…³å¹²éƒ¨é€šè®¯å½•",
                    exportTime: new Date().toISOString(),
                    version: "1.0",
                    totalContacts: contacts.length
                },
                contacts: contacts.map(contact => ({
                    name: contact.name,
                    department: contact.department,
                    mobile: contact.mobile || "",
                    officePhone: contact.officePhone || "",
                    homePhone: contact.homePhone || ""
                }))
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `é€šè®¯å½•æ•°æ®_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccessMessage(`å·²å¯¼å‡º ${contacts.length} æ¡è”ç³»äººæ•°æ®`);
        }

        // å¯¼å‡ºå¤‡ä»½æ•°æ®ï¼ˆåŒ…å«å®Œæ•´å…ƒæ•°æ®ï¼‰
        function exportDataForBackup() {
            const backupData = {
                version: CURRENT_VERSION,
                contacts: contacts,
                nextId: nextId,
                timestamp: new Date().toISOString(),
                backup: true,
                metadata: {
                    title: "è‰¯ç‹åº„ä¹¡æœºå…³å¹²éƒ¨é€šè®¯å½• - å®Œæ•´å¤‡ä»½",
                    totalContacts: contacts.length,
                    departments: Array.from(departments),
                    exportedBy: "é€šè®¯å½•ç®¡ç†ç³»ç»Ÿ"
                }
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `é€šè®¯å½•å¤‡ä»½_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccessMessage('å¤‡ä»½æ–‡ä»¶å¯¼å‡ºæˆåŠŸ');
        }

        // å¯¼å…¥JSONæ•°æ®
        function importJsonData() {
            const fileInput = document.getElementById('jsonFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è¯·å…ˆé€‰æ‹©è¦å¯¼å…¥çš„JSONæ–‡ä»¶');
                return;
            }
            
            if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                alert('è¯·é€‰æ‹©JSONæ ¼å¼çš„æ–‡ä»¶');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    processImportData(jsonData);
                } catch (error) {
                    alert('JSONæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹');
                    console.error('JSONè§£æé”™è¯¯:', error);
                }
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // å¤„ç†å¯¼å…¥æ•°æ®
        function processImportData(jsonData) {
            let importContacts = [];
            
            // å°è¯•ä¸åŒçš„æ•°æ®æ ¼å¼
            if (jsonData.contacts && Array.isArray(jsonData.contacts)) {
                // æ ‡å‡†å¯¼å‡ºæ ¼å¼
                importContacts = jsonData.contacts;
            } else if (jsonData.backup && Array.isArray(jsonData.contacts)) {
                // å¤‡ä»½æ ¼å¼
                importContacts = jsonData.contacts;
            } else if (Array.isArray(jsonData)) {
                // ç›´æ¥æ•°ç»„æ ¼å¼
                importContacts = jsonData;
            } else {
                alert('æ— æ³•è¯†åˆ«çš„JSONæ•°æ®æ ¼å¼');
                return;
            }
            
            // éªŒè¯å’Œæ¸…ç†æ•°æ®
            const validContacts = [];
            const invalidContacts = [];
            
            importContacts.forEach((contact, index) => {
                if (validateContactData(contact)) {
                    // æ¸…ç†æ•°æ®
                    const cleanedContact = {
                        name: contact.name.trim(),
                        department: contact.department.trim(),
                        mobile: (contact.mobile || '').trim(),
                        officePhone: (contact.officePhone || '').trim(),
                        homePhone: (contact.homePhone || '').trim()
                    };
                    validContacts.push(cleanedContact);
                } else {
                    invalidContacts.push({index: index + 1, contact: contact});
                }
            });
            
            if (validContacts.length === 0) {
                alert('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è”ç³»äººæ•°æ®');
                return;
            }
            
            if (invalidContacts.length > 0) {
                console.warn('è·³è¿‡æ— æ•ˆæ•°æ®:', invalidContacts);
            }
            
            // æ£€æŸ¥é‡å¤è”ç³»äºº
            importConflicts = findConflicts(validContacts);
            pendingImportData = validContacts;
            
            // æ˜¾ç¤ºé¢„è§ˆ
            showImportPreview(validContacts, invalidContacts.length);
        }

        // éªŒè¯è”ç³»äººæ•°æ®
        function validateContactData(contact) {
            return contact && 
                   typeof contact.name === 'string' && 
                   contact.name.trim() !== '' &&
                   typeof contact.department === 'string' && 
                   contact.department.trim() !== '';
        }

        // æŸ¥æ‰¾é‡å¤è”ç³»äºº
        function findConflicts(importContacts) {
            const conflicts = [];
            
            importContacts.forEach(importContact => {
                const existing = contacts.find(existingContact => 
                    existingContact.name === importContact.name && 
                    existingContact.department === importContact.department
                );
                
                if (existing) {
                    conflicts.push({
                        import: importContact,
                        existing: existing
                    });
                }
            });
            
            return conflicts;
        }

        // æ˜¾ç¤ºå¯¼å…¥é¢„è§ˆ
        function showImportPreview(validContacts, invalidCount) {
            const summaryDiv = document.getElementById('importSummary');
            const previewDiv = document.getElementById('importPreviewList');
            const conflictSection = document.getElementById('conflictSection');
            const conflictList = document.getElementById('conflictList');
            
            // æ˜¾ç¤ºæ‘˜è¦ä¿¡æ¯
            summaryDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div><strong>æœ‰æ•ˆæ•°æ®ï¼š</strong> ${validContacts.length} æ¡</div>
                    <div><strong>æ— æ•ˆæ•°æ®ï¼š</strong> ${invalidCount} æ¡</div>
                    <div><strong>é‡å¤æ•°æ®ï¼š</strong> ${importConflicts.length} æ¡</div>
                    <div><strong>çŠ¶æ€ï¼š</strong> <span style="color: green;">å‡†å¤‡å¯¼å…¥</span></div>
                </div>
            `;
            
            // æ˜¾ç¤ºé¢„è§ˆæ•°æ®ï¼ˆå‰10æ¡ï¼‰
            const previewData = validContacts.slice(0, 10);
            previewDiv.innerHTML = previewData.map((contact, index) => `
                <div style="padding: 10px; border-bottom: 1px solid #eee; ${index % 2 === 0 ? 'background: #f9f9f9;' : ''}">
                    <div style="font-weight: bold; color: #333;">${contact.name}</div>
                    <div style="color: #666; font-size: 0.9em;">${contact.department}</div>
                    <div style="font-size: 0.8em; color: #888;">
                        ${contact.mobile ? `ğŸ“± ${contact.mobile}` : ''}
                        ${contact.officePhone ? `â˜ï¸ ${contact.officePhone}` : ''}
                        ${contact.homePhone ? `ğŸ  ${contact.homePhone}` : ''}
                    </div>
                </div>
            `).join('');
            
            if (validContacts.length > 10) {
                previewDiv.innerHTML += `<div style="padding: 10px; text-align: center; color: #666;">... è¿˜æœ‰ ${validContacts.length - 10} æ¡æ•°æ®</div>`;
            }
            
            // å¤„ç†é‡å¤æ•°æ®
            if (importConflicts.length > 0) {
                conflictSection.style.display = 'block';
                conflictList.innerHTML = importConflicts.map(conflict => `
                    <div style="padding: 8px; border-bottom: 1px solid #ddd;">
                        <strong>${conflict.import.name}</strong> (${conflict.import.department})
                        <div style="font-size: 0.8em; color: #666;">å°†ä¸ç°æœ‰è”ç³»äººäº§ç”Ÿå†²çª</div>
                    </div>
                `).join('');
            } else {
                conflictSection.style.display = 'none';
            }
            
            // æ˜¾ç¤ºé¢„è§ˆæ¨¡æ€æ¡†
            document.getElementById('importPreviewModal').style.display = 'block';
        }

        // ç¡®è®¤å¯¼å…¥
        function confirmImport() {
            if (!pendingImportData) {
                alert('æ²¡æœ‰å¾…å¯¼å…¥çš„æ•°æ®');
                return;
            }
            
            const conflictResolution = document.querySelector('input[name="conflictResolution"]:checked')?.value || 'skip';
            let importedCount = 0;
            let skippedCount = 0;
            let updatedCount = 0;
            
            pendingImportData.forEach(importContact => {
                const existingIndex = contacts.findIndex(c => 
                    c.name === importContact.name && c.department === importContact.department
                );
                
                if (existingIndex !== -1) {
                    // å¤„ç†é‡å¤æ•°æ®
                    switch (conflictResolution) {
                        case 'skip':
                            skippedCount++;
                            break;
                        case 'overwrite':
                            contacts[existingIndex] = {
                                ...contacts[existingIndex],
                                ...importContact
                            };
                            updatedCount++;
                            break;
                        case 'duplicate':
                            contacts.push({
                                id: nextId++,
                                ...importContact
                            });
                            importedCount++;
                            break;
                    }
                } else {
                    // æ–°å¢è”ç³»äºº
                    contacts.push({
                        id: nextId++,
                        ...importContact
                    });
                    importedCount++;
                }
            });
            
            // æ›´æ–°éƒ¨é—¨åˆ—è¡¨
            departments.clear();
            contacts.forEach(contact => {
                departments.add(contact.department);
            });
            
            // ä¿å­˜æ•°æ®
            saveContactsToStorage();
            
            // æ›´æ–°ç•Œé¢
            initializeDepartmentSelects();
            updateStats();
            displayContacts(contacts);
            
            // å…³é—­æ¨¡æ€æ¡†
            closeImportPreview();
            closeDataManagement();
            
            // æ˜¾ç¤ºç»“æœ
            let resultMessage = `å¯¼å…¥å®Œæˆï¼æ–°å¢ ${importedCount} æ¡`;
            if (updatedCount > 0) resultMessage += `ï¼Œæ›´æ–° ${updatedCount} æ¡`;
            if (skippedCount > 0) resultMessage += `ï¼Œè·³è¿‡ ${skippedCount} æ¡é‡å¤æ•°æ®`;
            
            showSuccessMessage(resultMessage);
            
            // æ¸…ç†
            pendingImportData = null;
            importConflicts = [];
            clearFileInput();
        }

        // å…³é—­å¯¼å…¥é¢„è§ˆ
        function closeImportPreview() {
            document.getElementById('importPreviewModal').style.display = 'none';
            pendingImportData = null;
            importConflicts = [];
        }

        // æ¸…é™¤æ–‡ä»¶é€‰æ‹©
        function clearFileInput() {
            document.getElementById('jsonFileInput').value = '';
        }

        // å…¼å®¹æ—§ç‰ˆæœ¬çš„å¯¼å‡ºå‡½æ•°
        function exportData() {
            exportDataAsJson();
        }
        
        function initializeContacts() {
            // é¦–å…ˆå°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            const hasLocalData = loadContactsFromStorage();
            
            if (!hasLocalData) {
                console.log('ä½¿ç”¨é»˜è®¤æ•°æ®');
            }
            
            // é‡æ–°æ„å»ºéƒ¨é—¨åˆ—è¡¨
            departments.clear();
            contacts.forEach(contact => {
                departments.add(contact.department);
            });
            
            initializeDepartmentSelects();
            updateStats();
            displayContacts(contacts);
            
            // æ˜¾ç¤ºæ•°æ®æ¥æºæç¤º
            if (hasLocalData) {
                showSuccessMessage('å·²åŠ è½½æœ¬åœ°ä¿å­˜çš„æ•°æ®');
            }
        }

        function parseContactsData() {
            contacts = [];
            departments.clear();
            
            defaultContactsData.split('\n').forEach(line => {
                const parts = line.trim().split(',');
                if (parts.length >= 6) {
                    const contact = {
                        id: parseInt(parts[0]),
                        department: parts[1].trim(),
                        name: parts[2].trim(),
                        officePhone: parts[3].trim(),
                        homePhone: parts[4].trim(),
                        mobile: parts[5].trim()
                    };
                    contacts.push(contact);
                    departments.add(contact.department);
                    if (contact.id >= nextId) {
                        nextId = contact.id + 1;
                    }
                }
            });
        }

        function initializeDepartmentSelects() {
            // åˆå§‹åŒ–æœç´¢éƒ¨é—¨ä¸‹æ‹‰æ¡†
            const departmentFilter = document.getElementById('departmentFilter');
            departmentFilter.innerHTML = '<option value="">æ‰€æœ‰éƒ¨é—¨</option>';
            Array.from(departments).sort().forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                departmentFilter.appendChild(option);
            });

            // åˆå§‹åŒ–è¡¨å•éƒ¨é—¨ä¸‹æ‹‰æ¡†
            const contactDepartment = document.getElementById('contactDepartment');
            contactDepartment.innerHTML = '<option value="">è¯·é€‰æ‹©éƒ¨é—¨</option>';
            Array.from(departments).sort().forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                contactDepartment.appendChild(option);
            });
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = contacts.length;
        }
        
        // åˆ›å»ºè”ç³»äººå¡ç‰‡
        function createContactCard(contact) {
            const card = document.createElement('div');
            card.className = 'contact-card';
            
            let html = `
                <div class="contact-actions">
                    <button class="btn-edit" onclick="editContact(${contact.id})" title="ç¼–è¾‘">âœï¸</button>
                    <button class="btn-delete" onclick="deleteContact(${contact.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                </div>
                <div class="name">${contact.name}</div>
                <div class="department">${contact.department}</div>
            `;
            
            if (contact.mobile) {
                html += `<div class="info-item"><span class="icon">ğŸ“±</span>${contact.mobile}</div>`;
            }
            
            if (contact.officePhone) {
                html += `<div class="info-item"><span class="icon">â˜ï¸</span>${contact.officePhone}</div>`;
            }
            
            if (contact.homePhone && contact.homePhone !== 'ç—…å‡') {
                html += `<div class="info-item"><span class="icon">ğŸ </span>${contact.homePhone}</div>`;
            }
            
            card.innerHTML = html;
            return card;
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰è”ç³»äºº
        function displayContacts(contactList) {
            const grid = document.getElementById('contactGrid');
            grid.innerHTML = '';
            
            if (contactList.length === 0) {
                grid.innerHTML = '<div class="no-results">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è”ç³»äºº</div>';
                return;
            }
            
            contactList.forEach(contact => {
                grid.appendChild(createContactCard(contact));
            });
            
            document.getElementById('filteredCount').textContent = contactList.length;
        }
        
        // ç­›é€‰è”ç³»äºº
        function filterContacts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedDept = document.getElementById('departmentFilter').value;
            
            const filtered = contacts.filter(contact => {
                const matchSearch = !searchTerm || 
                    contact.name.toLowerCase().includes(searchTerm) ||
                    contact.department.toLowerCase().includes(searchTerm) ||
                    (contact.mobile && contact.mobile.includes(searchTerm)) ||
                    (contact.officePhone && contact.officePhone.includes(searchTerm)) ||
                    (contact.homePhone && contact.homePhone.includes(searchTerm));
                
                const matchDept = !selectedDept || contact.department === selectedDept;
                
                return matchSearch && matchDept;
            });
            
            displayContacts(filtered);
        }

        // æ˜¾ç¤ºæ–°å¢è”ç³»äººæ¨¡æ€æ¡†
        function showAddModal() {
            editingContactId = null;
            document.getElementById('modalTitle').textContent = 'æ–°å¢è”ç³»äºº';
            document.getElementById('submitBtn').textContent = 'ä¿å­˜';
            document.getElementById('contactForm').reset();
            document.getElementById('contactModal').style.display = 'block';
        }

        // æ˜¾ç¤ºç¼–è¾‘è”ç³»äººæ¨¡æ€æ¡†
        function editContact(contactId) {
            const contact = contacts.find(c => c.id === contactId);
            if (!contact) return;

            editingContactId = contactId;
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘è”ç³»äºº';
            document.getElementById('submitBtn').textContent = 'æ›´æ–°';
            
            // å¡«å……è¡¨å•
            document.getElementById('contactName').value = contact.name;
            document.getElementById('contactDepartment').value = contact.department;
            document.getElementById('contactMobile').value = contact.mobile || '';
            document.getElementById('contactOfficePhone').value = contact.officePhone || '';
            document.getElementById('contactHomePhone').value = contact.homePhone || '';
            
            document.getElementById('contactModal').style.display = 'block';
        }

        // åˆ é™¤è”ç³»äºº
        function deleteContact(contactId) {
            const contact = contacts.find(c => c.id === contactId);
            if (!contact) return;

            if (confirm(`ç¡®å®šè¦åˆ é™¤è”ç³»äºº"${contact.name}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) {
                contacts = contacts.filter(c => c.id !== contactId);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveContactsToStorage();
                
                departments.clear();
                contacts.forEach(c => departments.add(c.department));
                initializeDepartmentSelects();
                
                updateStats();
                filterContacts();
                
                showSuccessMessage(`è”ç³»äºº"${contact.name}"å·²æˆåŠŸåˆ é™¤å¹¶ä¿å­˜`);
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('contactModal').style.display = 'none';
            document.getElementById('contactForm').reset();
            editingContactId = null;
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccessMessage(message) {
            const msgElement = document.getElementById('successMessage');
            msgElement.textContent = message;
            msgElement.style.display = 'block';
            
            setTimeout(() => {
                msgElement.style.display = 'none';
            }, 3000);
        }

        // æ˜¾ç¤ºæ•°æ®ç®¡ç†æ¨¡æ€æ¡†
        function showDataManagement() {
            document.getElementById('dataManageCount').textContent = contacts.length;
            
            // è·å–æœ€åæ›´æ–°æ—¶é—´
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    const updateTime = new Date(parsedData.timestamp).toLocaleString('zh-CN');
                    document.getElementById('lastUpdateTime').textContent = updateTime;
                } else {
                    document.getElementById('lastUpdateTime').textContent = 'æ— æœ¬åœ°æ•°æ®';
                }
            } catch (error) {
                document.getElementById('lastUpdateTime').textContent = 'è·å–å¤±è´¥';
            }
            
            document.getElementById('dataManagementModal').style.display = 'block';
        }

        // å…³é—­æ•°æ®ç®¡ç†æ¨¡æ€æ¡†
        function closeDataManagement() {
            document.getElementById('dataManagementModal').style.display = 'none';
        }

        // å¤„ç†è¡¨å•æäº¤
        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const contactData = {
                name: formData.get('name').trim(),
                department: formData.get('department'),
                mobile: formData.get('mobile').trim(),
                officePhone: formData.get('officePhone').trim(),
                homePhone: formData.get('homePhone').trim()
            };

            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!contactData.name || !contactData.department) {
                alert('è¯·å¡«å†™å§“åå’Œéƒ¨é—¨ï¼');
                return;
            }

            // éªŒè¯æ‰‹æœºå·æ ¼å¼
            if (contactData.mobile && !/^1[3-9]\d{9}$/.test(contactData.mobile)) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ï¼');
                return;
            }

            if (editingContactId) {
                // æ›´æ–°ç°æœ‰è”ç³»äºº
                const contactIndex = contacts.findIndex(c => c.id === editingContactId);
                if (contactIndex !== -1) {
                    contacts[contactIndex] = {
                        ...contacts[contactIndex],
                        ...contactData
                    };
                    showSuccessMessage(`è”ç³»äºº"${contactData.name}"å·²æˆåŠŸæ›´æ–°å¹¶ä¿å­˜`);
                }
            } else {
                // æ–°å¢è”ç³»äºº
                const newContact = {
                    id: nextId++,
                    ...contactData
                };
                contacts.push(newContact);
                showSuccessMessage(`è”ç³»äºº"${contactData.name}"å·²æˆåŠŸæ·»åŠ å¹¶ä¿å­˜`);
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveContactsToStorage();
            
            // æ›´æ–°æ•°æ®
            departments.add(contactData.department);
            initializeDepartmentSelects();
            updateStats();
            filterContacts();
            closeModal();
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            const contactModal = document.getElementById('contactModal');
            const dataModal = document.getElementById('dataManagementModal');
            const importModal = document.getElementById('importPreviewModal');
            
            if (event.target === contactModal) {
                closeModal();
            } else if (event.target === dataModal) {
                closeDataManagement();
            } else if (event.target === importModal) {
                closeImportPreview();
            }
        });

        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
                closeDataManagement();
                closeImportPreview();
            }
        });
    </script>
</body>
</html>
